<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²·å…¥æ™‚é–“è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Heiti TC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .form-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .amount-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
        }

        .amount-group select {
            width: 100px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .radio-label:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .radio-label input[type="radio"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-label input[type="radio"]:checked + span {
            color: #667eea;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .schedule-list {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .schedule-list h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .schedule-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .schedule-info {
            flex: 1;
            min-width: 200px;
        }

        .schedule-info strong {
            color: #667eea;
            font-size: 1.1em;
        }

        .schedule-info div {
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .edit-btn {
            background: #ffc107;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .edit-btn:hover {
            background: #e0a800;
            transform: scale(1.05);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 100px;
        }

        .action-btn span {
            font-size: 2em;
        }

        .action-btn div {
            font-weight: bold;
            color: #333;
        }

        .action-btn.export {
            border-left: 4px solid #17a2b8;
        }

        .action-btn.import {
            border-left: 4px solid #28a745;
        }

        .action-btn.reset {
            border-left: 4px solid #dc3545;
        }

        .action-btn.add {
            border-left: 4px solid #667eea;
        }

        .action-btn.back {
            border-left: 4px solid #6c757d;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .month-selector {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .month-selector label {
            font-weight: bold;
            color: #333;
        }

        .month-selector select {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            background: white;
            color: #667eea;
            transition: all 0.3s;
        }

        .month-selector select:hover {
            background: #f8f9ff;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .calendar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .weekday-header {
            background: #f0f0f0;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .weekday-header.sunday {
            color: #e74c3c;
        }

        .weekday-header.saturday {
            color: #3498db;
        }

        .calendar-day {
            min-height: 100px;
            border: 1px solid #ddd;
            padding: 8px;
            background: white;
            position: relative;
            transition: all 0.3s;
        }

        .calendar-day:hover {
            background: #f8f9ff;
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-day.empty {
            background: #f9f9f9;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
            font-size: 1.1em;
        }

        .calendar-day.sunday .day-number {
            color: #e74c3c;
        }

        .calendar-day.saturday .day-number {
            color: #3498db;
        }

        .calendar-day.today {
            background: #fff9e6;
            border: 2px solid #ffc107;
        }

        .event {
            font-size: 0.75em;
            padding: 4px 6px;
            margin: 3px 0;
            border-radius: 4px;
            line-height: 1.3;
            font-weight: 500;
        }

        .event.monthly {
            background: #cfe2ff;
            color: #084298;
            border-left: 3px solid #0d6efd;
        }

        .event.weekly {
            background: #fff3cd;
            color: #856404;
            border-left: 3px solid #ffc107;
        }

        .event.once {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 3px solid #17a2b8;
        }

        .event.announcement {
            background: #e0cffc;
            color: #59359a;
            border-left: 3px solid #9333ea;
        }

        .event.exdate {
            background: #d1f4e0;
            color: #0f5132;
            border-left: 3px solid #198754;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .form-card {
                padding: 20px;
            }

            .calendar-day {
                min-height: 80px;
                padding: 5px;
                font-size: 0.85em;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .action-buttons {
                gap: 10px;
            }
            
            .action-btn {
                min-width: 80px;
                padding: 12px 15px;
            }
            
            .action-btn span {
                font-size: 1.5em;
            }
            
            .action-btn div {
                font-size: 0.85em;
            }

            .month-selector {
                flex-direction: column;
                align-items: stretch;
            }

            .month-selector select {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .calendar-day {
                min-height: 60px;
                font-size: 0.75em;
            }

            .event {
                font-size: 0.65em;
                padding: 2px 4px;
            }
        }
    </style>
</head>
<body>
    <a href="guide.html" style="position:fixed;top:10px;left:10px;padding:8px 16px;background:rgba(0,0,0,0.7);color:#fff;text-decoration:none;border-radius:6px;font-size:14px;z-index:9999;">â† è¿”å›æŒ‡å—</a>
    <div class="container">
        <!-- æœˆæ›†é é¢ -->
        <div id="calendarPage" class="page active">
            <h1>ğŸ“Š è²·å…¥æ™‚é–“è¡¨</h1>
            <div class="action-buttons">
                <button class="action-btn add" id="goToInputBtn">
                    <span>â•</span>
                    <div>æ–°å¢æ’ç¨‹</div>
                </button>
                <button class="action-btn add" id="goToAnnouncementBtn">
                    <span>ğŸ“¢</span>
                    <div>å…¬ä½ˆæ’ç¨‹</div>
                </button>
                <button class="action-btn export" id="exportBtn">
                    <span>ğŸ“¤</span>
                    <div>å°å‡ºæ•¸æ“š</div>
                </button>
                <button class="action-btn import" id="importBtn">
                    <span>ğŸ“¥</span>
                    <div>åŒ¯å…¥æ•¸æ“š</div>
                </button>
                <button class="action-btn reset" id="resetBtn">
                    <span>ğŸ”„</span>
                    <div>é‡è¨­æ•¸æ“š</div>
                </button>
                <button class="action-btn" id="syncToGitHubBtn" style="border-left: 4px solid #6f42c1;">
                    <span>â˜ï¸</span>
                    <div>åŒæ­¥åˆ°GitHub</div>
                </button>
                <button class="action-btn" id="loadFromGitHubBtn" style="border-left: 4px solid #20c997;">
                    <span>ğŸ“¥</span>
                    <div>å¾GitHubè¼‰å…¥</div>
                </button>
            </div>
            <div class="month-selector">
                <label>å¹´ä»½ï¼š</label>
                <select id="yearSelect"></select>
                <label>æœˆä»½ï¼š</label>
                <select id="monthSelect">
                    <option value="1">1æœˆ</option>
                    <option value="2">2æœˆ</option>
                    <option value="3">3æœˆ</option>
                    <option value="4">4æœˆ</option>
                    <option value="5">5æœˆ</option>
                    <option value="6">6æœˆ</option>
                    <option value="7">7æœˆ</option>
                    <option value="8">8æœˆ</option>
                    <option value="9">9æœˆ</option>
                    <option value="10">10æœˆ</option>
                    <option value="11">11æœˆ</option>
                    <option value="12">12æœˆ</option>
                </select>
            </div>
            <div class="calendar-container">
                <div class="calendar-header" id="calendarHeader"></div>
                <div class="calendar" id="calendar"></div>
            </div>
        </div>

        <!-- è¼¸å…¥é é¢ -->
        <div id="inputPage" class="page">
            <h1>ğŸ“Š è²·å…¥æ™‚é–“è¡¨ - æ–°å¢æ’ç¨‹</h1>
            <div class="action-buttons">
                <button class="action-btn back" id="backToCalendar">
                    <span>ğŸ”™</span>
                    <div>è¿”å›æœˆæ›†</div>
                </button>
                <button class="action-btn export" id="exportBtnInput">
                    <span>ğŸ“¤</span>
                    <div>å°å‡ºæ•¸æ“š</div>
                </button>
                <button class="action-btn import" id="importBtnInput">
                    <span>ğŸ“¥</span>
                    <div>åŒ¯å…¥æ•¸æ“š</div>
                </button>
                <button class="action-btn reset" id="resetBtnInput">
                    <span>ğŸ”„</span>
                    <div>é‡è¨­æ•¸æ“š</div>
                </button>
                <button class="action-btn" id="syncToGitHubBtnInput" style="border-left: 4px solid #6f42c1;">
                    <span>â˜ï¸</span>
                    <div>åŒæ­¥åˆ°GitHub</div>
                </button>
                <button class="action-btn" id="loadFromGitHubBtnInput" style="border-left: 4px solid #20c997;">
                    <span>ğŸ“¥</span>
                    <div>å¾GitHubè¼‰å…¥</div>
                </button>
            </div>
            <div class="form-card">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label>è‚¡ç¥¨åç¨± *</label>
                        <input type="text" id="stockName" required>
                    </div>
                    <div class="form-group">
                        <label>è²·å…¥æ—¥ *</label>
                        <input type="date" id="buyDate" required>
                    </div>
                    <div class="form-group">
                        <label>æ•¸é‡ *</label>
                        <div class="amount-group">
                            <input type="number" id="amount" required min="0" step="any">
                            <select id="unit">
                                <option value="å…ƒ">å…ƒ</option>
                                <option value="æ‰‹">æ‰‹</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æ˜¯å¦æŒçºŒï¼Ÿ *</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="continuous" value="no" checked>
                                <span>å¦</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="continuous" value="yes">
                                <span>æ˜¯</span>
                            </label>
                        </div>
                    </div>
                    <div id="continuousOptions" class="hidden">
                        <div class="form-group">
                            <label>æœŸé™ *</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="limitType" value="limited">
                                    <span>æœ‰é™æœŸ</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="limitType" value="unlimited">
                                    <span>ç„¡é™æœŸ</span>
                                </label>
                            </div>
                        </div>
                        <div id="limitedOptions" class="hidden">
                            <div class="form-group">
                                <label>å¤šå°‘æœŸï¼Ÿ *</label>
                                <input type="number" id="periods" min="1">
                            </div>
                        </div>
                        <div id="cycleOptions" class="hidden">
                            <div class="form-group">
                                <label>å‘¨æœŸ *</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="cycleType" value="weekly">
                                        <span>æ¯é€±</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="cycleType" value="firstWorkday">
                                        <span>æ¯æœˆç¬¬ä¸€å€‹å·¥ä½œå¤©</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="cycleType" value="monthlyDate">
                                        <span>æ¯æœˆ XX è™Ÿ</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="cycleType" value="everyXMonths">
                                        <span>æ¯éš” X å€‹æœˆçš„ X è™Ÿ</span>
                                    </label>
                                </div>
                            </div>
                            <div id="weeklyOptions" class="hidden">
                                <div class="form-group">
                                    <label>æ˜ŸæœŸå¹¾ï¼Ÿ *</label>
                                    <select id="weekday">
                                        <option value="1">æ˜ŸæœŸä¸€</option>
                                        <option value="2">æ˜ŸæœŸäºŒ</option>
                                        <option value="3">æ˜ŸæœŸä¸‰</option>
                                        <option value="4">æ˜ŸæœŸå››</option>
                                        <option value="5">æ˜ŸæœŸäº”</option>
                                        <option value="6">æ˜ŸæœŸå…­</option>
                                        <option value="0">æ˜ŸæœŸæ—¥</option>
                                    </select>
                                </div>
                            </div>
                            <div id="monthlyDateOptions" class="hidden">
                                <div class="form-group">
                                    <label>æ—¥æœŸ *</label>
                                    <input type="number" id="monthlyDay" min="1" max="31">
                                </div>
                            </div>
                            <div id="everyXMonthsOptions" class="hidden">
                                <div class="form-group">
                                    <label>æ¯éš”å¹¾å€‹æœˆï¼Ÿ *</label>
                                    <input type="number" id="everyXMonthsInterval" min="1">
                                </div>
                                <div class="form-group">
                                    <label>æ—¥æœŸ *</label>
                                    <input type="number" id="everyXMonthsDay" min="1" max="31">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">å„²å­˜æ’ç¨‹</button>
                        <button type="button" class="btn btn-secondary" id="viewCalendarFromForm">æŸ¥çœ‹æœˆæ›†</button>
                    </div>
                </form>
                <div id="scheduleList" class="schedule-list hidden">
                    <h3>å·²æ–°å¢çš„æ’ç¨‹ï¼š</h3>
                    <div id="schedules"></div>
                </div>
            </div>
        </div>

        <!-- å…¬ä½ˆæ’ç¨‹é é¢ -->
        <div id="announcementPage" class="page">
            <h1>ğŸ“¢ è²·å…¥æ™‚é–“è¡¨ - å…¬ä½ˆæ’ç¨‹</h1>
            <div class="action-buttons">
                <button class="action-btn back" id="backToCalendarFromAnnouncement">
                    <span>ğŸ”™</span>
                    <div>è¿”å›æœˆæ›†</div>
                </button>
                <button class="action-btn export" id="exportBtnAnnouncement">
                    <span>ğŸ“¤</span>
                    <div>å°å‡ºæ•¸æ“š</div>
                </button>
                <button class="action-btn import" id="importBtnAnnouncement">
                    <span>ğŸ“¥</span>
                    <div>åŒ¯å…¥æ•¸æ“š</div>
                </button>
                <button class="action-btn reset" id="resetBtnAnnouncement">
                    <span>ğŸ”„</span>
                    <div>é‡è¨­æ•¸æ“š</div>
                </button>
                <button class="action-btn" id="syncToGitHubBtnAnnouncement" style="border-left: 4px solid #6f42c1;">
                    <span>â˜ï¸</span>
                    <div>åŒæ­¥åˆ°GitHub</div>
                </button>
                <button class="action-btn" id="loadFromGitHubBtnAnnouncement" style="border-left: 4px solid #20c997;">
                    <span>ğŸ“¥</span>
                    <div>å¾GitHubè¼‰å…¥</div>
                </button>
            </div>
            <div class="form-card">
                <form id="announcementForm">
                    <div class="form-group">
                        <label>è‚¡ç¥¨åç¨± *</label>
                        <input type="text" id="announcementStockName" required>
                    </div>
                    <h3 style="margin: 20px 0 15px; color: #667eea;">å…¬ä½ˆæ—¥è¨­å®š *</h3>
                    <div class="form-group">
                        <label>èµ·å§‹å…¬ä½ˆæ—¥ *</label>
                        <input type="date" id="announcementDate" required>
                    </div>
                    <div class="form-group">
                        <label>å…¬ä½ˆæ—¥å‘¨æœŸ *</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="announcementCycle" value="weekly">
                                <span>æ¯é€±</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="announcementCycle" value="monthlyDate" checked>
                                <span>æ¯æœˆ XX è™Ÿ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="announcementCycle" value="everyXMonths">
                                <span>æ¯éš” X å€‹æœˆçš„ X è™Ÿ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="announcementCycle" value="yearly">
                                <span>æ¯å¹´ X æœˆ X è™Ÿ</span>
                            </label>
                        </div>
                    </div>
                    <div id="announcementWeeklyOptions" class="hidden">
                        <div class="form-group">
                            <label>æ˜ŸæœŸå¹¾ï¼Ÿ *</label>
                            <select id="announcementWeekday">
                                <option value="1">æ˜ŸæœŸä¸€</option>
                                <option value="2">æ˜ŸæœŸäºŒ</option>
                                <option value="3">æ˜ŸæœŸä¸‰</option>
                                <option value="4">æ˜ŸæœŸå››</option>
                                <option value="5">æ˜ŸæœŸäº”</option>
                                <option value="6">æ˜ŸæœŸå…­</option>
                                <option value="0">æ˜ŸæœŸæ—¥</option>
                            </select>
                        </div>
                    </div>
                    <div id="announcementMonthlyDateOptions">
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="announcementMonthlyDay" min="1" max="31">
                        </div>
                    </div>
                    <div id="announcementEveryXMonthsOptions" class="hidden">
                        <div class="form-group">
                            <label>æ¯éš”å¹¾å€‹æœˆï¼Ÿ *</label>
                            <input type="number" id="announcementEveryXMonthsInterval" min="1">
                        </div>
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="announcementEveryXMonthsDay" min="1" max="31">
                        </div>
                    </div>
                    <div id="announcementYearlyOptions" class="hidden">
                        <div class="form-group">
                            <label>æœˆä»½ *</label>
                            <select id="announcementYearlyMonth">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="announcementYearlyDay" min="1" max="31">
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px; color: #198754;">é™¤æ·¨æ—¥è¨­å®š *</h3>
                    <div class="form-group">
                        <label>èµ·å§‹é™¤æ·¨æ—¥ *</label>
                        <input type="date" id="exDate" required>
                    </div>
                    <div class="form-group">
                        <label>é™¤æ·¨æ—¥å‘¨æœŸ *</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="exCycle" value="weekly">
                                <span>æ¯é€±</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="exCycle" value="monthlyDate" checked>
                                <span>æ¯æœˆ XX è™Ÿ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="exCycle" value="everyXMonths">
                                <span>æ¯éš” X å€‹æœˆçš„ X è™Ÿ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="exCycle" value="yearly">
                                <span>æ¯å¹´ X æœˆ X è™Ÿ</span>
                            </label>
                        </div>
                    </div>
                    <div id="exWeeklyOptions" class="hidden">
                        <div class="form-group">
                            <label>æ˜ŸæœŸå¹¾ï¼Ÿ *</label>
                            <select id="exWeekday">
                                <option value="1">æ˜ŸæœŸä¸€</option>
                                <option value="2">æ˜ŸæœŸäºŒ</option>
                                <option value="3">æ˜ŸæœŸä¸‰</option>
                                <option value="4">æ˜ŸæœŸå››</option>
                                <option value="5">æ˜ŸæœŸäº”</option>
                                <option value="6">æ˜ŸæœŸå…­</option>
                                <option value="0">æ˜ŸæœŸæ—¥</option>
                            </select>
                        </div>
                    </div>
                    <div id="exMonthlyDateOptions">
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="exMonthlyDay" min="1" max="31">
                        </div>
                    </div>
                    <div id="exEveryXMonthsOptions" class="hidden">
                        <div class="form-group">
                            <label>æ¯éš”å¹¾å€‹æœˆï¼Ÿ *</label>
                            <input type="number" id="exEveryXMonthsInterval" min="1">
                        </div>
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="exEveryXMonthsDay" min="1" max="31">
                        </div>
                    </div>
                    <div id="exYearlyOptions" class="hidden">
                        <div class="form-group">
                            <label>æœˆä»½ *</label>
                            <select id="exYearlyMonth">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ—¥æœŸ *</label>
                            <input type="number" id="exYearlyDay" min="1" max="31">
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">å„²å­˜æ’ç¨‹</button>
                        <button type="button" class="btn btn-secondary" id="viewCalendarFromAnnouncement">æŸ¥çœ‹æœˆæ›†</button>
                    </div>
                </form>
                <div id="announcementScheduleList" class="schedule-list hidden">
                    <h3>å·²æ–°å¢çš„å…¬ä½ˆæ’ç¨‹ï¼š</h3>
                    <div id="announcementSchedules"></div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;">

    <script>
        // å…¨å±€è®Šé‡
        let schedules = [];
        let announcements = [];
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;
        let editingId = null;
        let editingAnnouncementId = null;

        // ======================================
        // IndexedDB
        // ======================================
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('BuyScheduleDB', 2);

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('schedules')) {
                        db.createObjectStore('schedules', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('announcements')) {
                        db.createObjectStore('announcements', { keyPath: 'id' });
                    }
                };

                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject('âŒ IndexedDB é–‹å•Ÿå¤±æ•—:' + event.target.errorCode);
            });
        }

        async function saveSchedules() {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction('schedules', 'readwrite');
                const store = tx.objectStore('schedules');
                const clearReq = store.clear();
                clearReq.onsuccess = () => {
                    schedules.forEach(schedule => store.put(schedule));
                };
                tx.oncomplete = () => resolve(true);
                tx.onerror = () => reject('âŒ å­˜æª”å¤±æ•—');
            });
        }

        async function loadSchedules() {
            const db = await openDB();
            return new Promise((resolve) => {
                const tx = db.transaction('schedules', 'readonly');
                const store = tx.objectStore('schedules');
                const request = store.getAll();

                request.onsuccess = (event) => {
                    schedules = event.target.result || [];
                    updateScheduleList();
                    renderCalendar();
                    resolve(schedules);
                };
                request.onerror = () => {
                    console.error('âŒ è®€å–å¤±æ•—');
                    schedules = [];
                    resolve([]);
                };
            });
        }

        async function deleteSchedule(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ’ç¨‹å—ï¼Ÿ')) {
                const db = await openDB();
                const tx = db.transaction('schedules', 'readwrite');
                tx.objectStore('schedules').delete(id);
                schedules = schedules.filter(s => s.id !== id);
                updateScheduleList();
                renderCalendar();
            }
        }

        async function saveAnnouncements() {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const tx = db.transaction('announcements', 'readwrite');
                const store = tx.objectStore('announcements');
                const clearReq = store.clear();
                clearReq.onsuccess = () => {
                    announcements.forEach(announcement => store.put(announcement));
                };
                tx.oncomplete = () => resolve(true);
                tx.onerror = () => reject('âŒ å­˜æª”å¤±æ•—');
            });
        }

        async function loadAnnouncements() {
            const db = await openDB();
            return new Promise((resolve) => {
                const tx = db.transaction('announcements', 'readonly');
                const store = tx.objectStore('announcements');
                const request = store.getAll();

                request.onsuccess = (event) => {
                    announcements = event.target.result || [];
                    updateAnnouncementList();
                    renderCalendar();
                    resolve(announcements);
                };
                request.onerror = () => {
                    console.error('âŒ è®€å–å¤±æ•—');
                    announcements = [];
                    resolve([]);
                };
            });
        }

        async function deleteAnnouncement(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å…¬ä½ˆæ’ç¨‹å—ï¼Ÿ')) {
                const db = await openDB();
                const tx = db.transaction('announcements', 'readwrite');
                tx.objectStore('announcements').delete(id);
                announcements = announcements.filter(a => a.id !== id);
                updateAnnouncementList();
                renderCalendar();
            }
        }

        // ======================================
        // é é¢åˆ‡æ›
        // ======================================
        const inputPage = document.getElementById('inputPage');
        const calendarPage = document.getElementById('calendarPage');
        const announcementPage = document.getElementById('announcementPage');
        const goToInputBtn = document.getElementById('goToInputBtn');
        const goToAnnouncementBtn = document.getElementById('goToAnnouncementBtn');
        const backToCalendar = document.getElementById('backToCalendar');
        const backToCalendarFromAnnouncement = document.getElementById('backToCalendarFromAnnouncement');
        const viewCalendarFromForm = document.getElementById('viewCalendarFromForm');
        const viewCalendarFromAnnouncement = document.getElementById('viewCalendarFromAnnouncement');

        goToInputBtn.addEventListener('click', () => {
            calendarPage.classList.remove('active');
            inputPage.classList.add('active');
        });

        goToAnnouncementBtn.addEventListener('click', () => {
            calendarPage.classList.remove('active');
            announcementPage.classList.add('active');
        });

        backToCalendar.addEventListener('click', () => {
            inputPage.classList.remove('active');
            calendarPage.classList.add('active');
            renderCalendar();
        });

        backToCalendarFromAnnouncement.addEventListener('click', () => {
            announcementPage.classList.remove('active');
            calendarPage.classList.add('active');
            renderCalendar();
        });

        viewCalendarFromForm.addEventListener('click', () => {
            inputPage.classList.remove('active');
            calendarPage.classList.add('active');
            renderCalendar();
        });

        viewCalendarFromAnnouncement.addEventListener('click', () => {
            announcementPage.classList.remove('active');
            calendarPage.classList.add('active');
            renderCalendar();
        });

        // ======================================
        // è¡¨å–®é‚è¼¯ - è²·å…¥æ’ç¨‹
        // ======================================
        const form = document.getElementById('scheduleForm');
        const continuousRadios = document.querySelectorAll('input[name="continuous"]');
        const limitTypeRadios = document.querySelectorAll('input[name="limitType"]');
        const cycleTypeRadios = document.querySelectorAll('input[name="cycleType"]');

        const continuousOptions = document.getElementById('continuousOptions');
        const limitedOptions = document.getElementById('limitedOptions');
        const cycleOptions = document.getElementById('cycleOptions');
        const weeklyOptions = document.getElementById('weeklyOptions');
        const monthlyDateOptions = document.getElementById('monthlyDateOptions');
        const everyXMonthsOptions = document.getElementById('everyXMonthsOptions');

        continuousRadios.forEach(radio => {
            radio.addEventListener('change', e => {
                if (e.target.value === 'yes') {
                    continuousOptions.classList.remove('hidden');
                } else {
                    continuousOptions.classList.add('hidden');
                    limitedOptions.classList.add('hidden');
                    cycleOptions.classList.add('hidden');
                }
            });
        });

        limitTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'limited') limitedOptions.classList.remove('hidden');
                else limitedOptions.classList.add('hidden');
                cycleOptions.classList.remove('hidden');
            });
        });

        cycleTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                weeklyOptions.classList.add('hidden');
                monthlyDateOptions.classList.add('hidden');
                everyXMonthsOptions.classList.add('hidden');
                if (e.target.value === 'weekly') weeklyOptions.classList.remove('hidden');
                else if (e.target.value === 'monthlyDate') monthlyDateOptions.classList.remove('hidden');
                else if (e.target.value === 'everyXMonths') everyXMonthsOptions.classList.remove('hidden');
            });
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const stockName = document.getElementById('stockName').value;
            const buyDate = document.getElementById('buyDate').value;
            const amount = document.getElementById('amount').value;
            const unit = document.getElementById('unit').value;
            const continuous = document.querySelector('input[name="continuous"]:checked').value;

            const schedule = {
                id: editingId || Date.now(),
                stockName, buyDate, amount, unit,
                continuous: continuous === 'yes'
            };

            if (schedule.continuous) {
                const limitType = document.querySelector('input[name="limitType"]:checked')?.value;
                schedule.limitType = limitType;
                if (limitType === 'limited') schedule.periods = parseInt(document.getElementById('periods').value);

                const cycleType = document.querySelector('input[name="cycleType"]:checked')?.value;
                schedule.cycleType = cycleType;
                if (cycleType === 'weekly') {
                    schedule.weekday = parseInt(document.getElementById('weekday').value);
                } else if (cycleType === 'monthlyDate') {
                    schedule.monthlyDay = parseInt(document.getElementById('monthlyDay').value);
                } else if (cycleType === 'everyXMonths') {
                    schedule.everyXMonthsInterval = parseInt(document.getElementById('everyXMonthsInterval').value);
                    schedule.everyXMonthsDay = parseInt(document.getElementById('everyXMonthsDay').value);
                }
            }

            if (editingId) {
                const idx = schedules.findIndex(s => s.id === editingId);
                if (idx !== -1) schedules[idx] = schedule;
                alert('âœï¸ æ’ç¨‹å·²æ›´æ–°ï¼');
                editingId = null;
            } else {
                schedules.push(schedule);
                alert('âœ… æ’ç¨‹å·²æ–°å¢ï¼');
            }
            await saveSchedules();
            updateScheduleList();
            renderCalendar();
            form.reset();
            continuousOptions.classList.add('hidden');
        });

        // ======================================
        // è¡¨å–®é‚è¼¯ - å…¬ä½ˆæ’ç¨‹
        // ======================================
        const announcementForm = document.getElementById('announcementForm');
        const announcementCycleRadios = document.querySelectorAll('input[name="announcementCycle"]');
        const announcementWeeklyOptions = document.getElementById('announcementWeeklyOptions');
        const announcementMonthlyDateOptions = document.getElementById('announcementMonthlyDateOptions');
        const announcementEveryXMonthsOptions = document.getElementById('announcementEveryXMonthsOptions');
        const announcementYearlyOptions = document.getElementById('announcementYearlyOptions');

        announcementCycleRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                announcementWeeklyOptions.classList.add('hidden');
                announcementMonthlyDateOptions.classList.add('hidden');
                announcementEveryXMonthsOptions.classList.add('hidden');
                announcementYearlyOptions.classList.add('hidden');
                
                if (e.target.value === 'weekly') announcementWeeklyOptions.classList.remove('hidden');
                else if (e.target.value === 'monthlyDate') announcementMonthlyDateOptions.classList.remove('hidden');
                else if (e.target.value === 'everyXMonths') announcementEveryXMonthsOptions.classList.remove('hidden');
                else if (e.target.value === 'yearly') announcementYearlyOptions.classList.remove('hidden');
            });
        });

        const exCycleRadios = document.querySelectorAll('input[name="exCycle"]');
        const exWeeklyOptions = document.getElementById('exWeeklyOptions');
        const exMonthlyDateOptions = document.getElementById('exMonthlyDateOptions');
        const exEveryXMonthsOptions = document.getElementById('exEveryXMonthsOptions');
        const exYearlyOptions = document.getElementById('exYearlyOptions');

        exCycleRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                exWeeklyOptions.classList.add('hidden');
                exMonthlyDateOptions.classList.add('hidden');
                exEveryXMonthsOptions.classList.add('hidden');
                exYearlyOptions.classList.add('hidden');
                
                if (e.target.value === 'weekly') exWeeklyOptions.classList.remove('hidden');
                else if (e.target.value === 'monthlyDate') exMonthlyDateOptions.classList.remove('hidden');
                else if (e.target.value === 'everyXMonths') exEveryXMonthsOptions.classList.remove('hidden');
                else if (e.target.value === 'yearly') exYearlyOptions.classList.remove('hidden');
            });
        });

        announcementForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const stockName = document.getElementById('announcementStockName').value;
            const announcementDate = document.getElementById('announcementDate').value;
            const exDate = document.getElementById('exDate').value;
            
            const announcementCycle = document.querySelector('input[name="announcementCycle"]:checked').value;
            const exCycle = document.querySelector('input[name="exCycle"]:checked').value;
            
            const announcement = {
                id: editingAnnouncementId || Date.now(),
                stockName,
                announcementDate,
                exDate,
                announcementCycle,
                exCycle
            };
            
            // å…¬ä½ˆæ—¥å‘¨æœŸè¯¦æƒ…
            if (announcementCycle === 'weekly') {
                announcement.announcementWeekday = parseInt(document.getElementById('announcementWeekday').value);
            } else if (announcementCycle === 'monthlyDate') {
                announcement.announcementMonthlyDay = parseInt(document.getElementById('announcementMonthlyDay').value);
            } else if (announcementCycle === 'everyXMonths') {
                announcement.announcementEveryXMonthsInterval = parseInt(document.getElementById('announcementEveryXMonthsInterval').value);
                announcement.announcementEveryXMonthsDay = parseInt(document.getElementById('announcementEveryXMonthsDay').value);
            } else if (announcementCycle === 'yearly') {
                announcement.announcementYearlyMonth = parseInt(document.getElementById('announcementYearlyMonth').value);
                announcement.announcementYearlyDay = parseInt(document.getElementById('announcementYearlyDay').value);
            }
            
            // é™¤æ·¨æ—¥å‘¨æœŸè¯¦æƒ…
            if (exCycle === 'weekly') {
                announcement.exWeekday = parseInt(document.getElementById('exWeekday').value);
            } else if (exCycle === 'monthlyDate') {
                announcement.exMonthlyDay = parseInt(document.getElementById('exMonthlyDay').value);
            } else if (exCycle === 'everyXMonths') {
                announcement.exEveryXMonthsInterval = parseInt(document.getElementById('exEveryXMonthsInterval').value);
                announcement.exEveryXMonthsDay = parseInt(document.getElementById('exEveryXMonthsDay').value);
            } else if (exCycle === 'yearly') {
                announcement.exYearlyMonth = parseInt(document.getElementById('exYearlyMonth').value);
                announcement.exYearlyDay = parseInt(document.getElementById('exYearlyDay').value);
            }
            
            if (editingAnnouncementId) {
                const idx = announcements.findIndex(a => a.id === editingAnnouncementId);
                if (idx !== -1) announcements[idx] = announcement;
                alert('âœï¸ å…¬ä½ˆæ’ç¨‹å·²æ›´æ–°ï¼');
                editingAnnouncementId = null;
            } else {
                announcements.push(announcement);
                alert('âœ… å…¬ä½ˆæ’ç¨‹å·²æ–°å¢ï¼');
            }
            
            await saveAnnouncements();
            updateAnnouncementList();
            renderCalendar();
            announcementForm.reset();
        });

        // ======================================
        // ç·¨è¼¯åŠŸèƒ½
        // ======================================
        window.editSchedule = function(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            document.getElementById('stockName').value = schedule.stockName;
            document.getElementById('buyDate').value = schedule.buyDate;
            document.getElementById('amount').value = schedule.amount;
            document.getElementById('unit').value = schedule.unit;
            if (schedule.continuous) {
                document.querySelector('input[name="continuous"][value="yes"]').checked = true;
                continuousOptions.classList.remove('hidden');
                if (schedule.limitType) {
                    document.querySelector(`input[name="limitType"][value="${schedule.limitType}"]`).checked = true;
                    if (schedule.limitType === 'limited') {
                        limitedOptions.classList.remove('hidden');
                        document.getElementById('periods').value = schedule.periods || '';
                    }
                }
                cycleOptions.classList.remove('hidden');
                if (schedule.cycleType) {
                    document.querySelector(`input[name="cycleType"][value="${schedule.cycleType}"]`).checked = true;
                    weeklyOptions.classList.add('hidden');
                    monthlyDateOptions.classList.add('hidden');
                    everyXMonthsOptions.classList.add('hidden');
                    if (schedule.cycleType === 'weekly') {
                        weeklyOptions.classList.remove('hidden');
                        document.getElementById('weekday').value = schedule.weekday;
                    } else if (schedule.cycleType === 'monthlyDate') {
                        monthlyDateOptions.classList.remove('hidden');
                        document.getElementById('monthlyDay').value = schedule.monthlyDay;
                    } else if (schedule.cycleType === 'everyXMonths') {
                        everyXMonthsOptions.classList.remove('hidden');
                        document.getElementById('everyXMonthsInterval').value = schedule.everyXMonthsInterval;
                        document.getElementById('everyXMonthsDay').value = schedule.everyXMonthsDay;
                    }
                }
            } else {
                document.querySelector('input[name="continuous"][value="no"]').checked = true;
                continuousOptions.classList.add('hidden');
            }
            editingId = id;
            calendarPage.classList.remove('active');
            inputPage.classList.add('active');
        };

        window.editAnnouncement = function(id) {
            const announcement = announcements.find(a => a.id === id);
            if (!announcement) return;
            
            document.getElementById('announcementStockName').value = announcement.stockName;
            document.getElementById('announcementDate').value = announcement.announcementDate;
            document.getElementById('exDate').value = announcement.exDate;
            
            // è®¾ç½®å…¬ä½ˆæ—¥å‘¨æœŸ
            document.querySelector(`input[name="announcementCycle"][value="${announcement.announcementCycle}"]`).checked = true;
            announcementWeeklyOptions.classList.add('hidden');
            announcementMonthlyDateOptions.classList.add('hidden');
            announcementEveryXMonthsOptions.classList.add('hidden');
            announcementYearlyOptions.classList.add('hidden');
            
            if (announcement.announcementCycle === 'weekly') {
                announcementWeeklyOptions.classList.remove('hidden');
                document.getElementById('announcementWeekday').value = announcement.announcementWeekday;
            } else if (announcement.announcementCycle === 'monthlyDate') {
                announcementMonthlyDateOptions.classList.remove('hidden');
                document.getElementById('announcementMonthlyDay').value = announcement.announcementMonthlyDay;
            } else if (announcement.announcementCycle === 'everyXMonths') {
                announcementEveryXMonthsOptions.classList.remove('hidden');
                document.getElementById('announcementEveryXMonthsInterval').value = announcement.announcementEveryXMonthsInterval;
                document.getElementById('announcementEveryXMonthsDay').value = announcement.announcementEveryXMonthsDay;
            } else if (announcement.announcementCycle === 'yearly') {
                announcementYearlyOptions.classList.remove('hidden');
                document.getElementById('announcementYearlyMonth').value = announcement.announcementYearlyMonth;
                document.getElementById('announcementYearlyDay').value = announcement.announcementYearlyDay;
            }
            
            // è®¾ç½®é™¤æ·¨æ—¥å‘¨æœŸ
            document.querySelector(`input[name="exCycle"][value="${announcement.exCycle}"]`).checked = true;
            exWeeklyOptions.classList.add('hidden');
            exMonthlyDateOptions.classList.add('hidden');
            exEveryXMonthsOptions.classList.add('hidden');
            exYearlyOptions.classList.add('hidden');
            
            if (announcement.exCycle === 'weekly') {
                exWeeklyOptions.classList.remove('hidden');
                document.getElementById('exWeekday').value = announcement.exWeekday;
            } else if (announcement.exCycle === 'monthlyDate') {
                exMonthlyDateOptions.classList.remove('hidden');
                document.getElementById('exMonthlyDay').value = announcement.exMonthlyDay;
            } else if (announcement.exCycle === 'everyXMonths') {
                exEveryXMonthsOptions.classList.remove('hidden');
                document.getElementById('exEveryXMonthsInterval').value = announcement.exEveryXMonthsInterval;
                document.getElementById('exEveryXMonthsDay').value = announcement.exEveryXMonthsDay;
            } else if (announcement.exCycle === 'yearly') {
                exYearlyOptions.classList.remove('hidden');
                document.getElementById('exYearlyMonth').value = announcement.exYearlyMonth;
                document.getElementById('exYearlyDay').value = announcement.exYearlyDay;
            }
            
            editingAnnouncementId = id;
            calendarPage.classList.remove('active');
            announcementPage.classList.add('active');
        };

        window.deleteSchedule = deleteSchedule;
        window.deleteAnnouncement = deleteAnnouncement;

        // ======================================
        // ç•«é¢æ›´æ–°
        // ======================================
        function updateScheduleList() {
            const list = document.getElementById('scheduleList');
            const divs = document.getElementById('schedules');
            if (schedules.length === 0) { list.classList.add('hidden'); return; }
            list.classList.remove('hidden');
            divs.innerHTML = '';
            schedules.forEach(schedule => {
                let cycleText = '';
                if (schedule.continuous) {
                    if (schedule.cycleType === 'weekly') {
                        const days = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
                        cycleText = `æ¯é€±${days[schedule.weekday]}`;
                    } else if (schedule.cycleType === 'firstWorkday') cycleText = 'æ¯æœˆç¬¬ä¸€å€‹å·¥ä½œå¤©';
                    else if (schedule.cycleType === 'monthlyDate') cycleText = `æ¯æœˆ${schedule.monthlyDay}è™Ÿ`;
                    else if (schedule.cycleType === 'everyXMonths') cycleText = `æ¯éš” ${schedule.everyXMonthsInterval} å€‹æœˆçš„ ${schedule.everyXMonthsDay} è™Ÿ`;
                    if (schedule.limitType === 'limited') cycleText += ` (${schedule.periods}æœŸ)`; else cycleText += ' (ç„¡é™æœŸ)';
                } else cycleText = 'å–®æ¬¡';
                const div = document.createElement('div');
                div.className = 'schedule-item';
                div.innerHTML = `
                    <div class="schedule-info">
                        <strong>${schedule.stockName}</strong>
                        <div>æ•¸é‡ï¼š${schedule.amount} ${schedule.unit} | é–‹å§‹æ—¥æœŸï¼š${schedule.buyDate}</div>
                        <div>å‘¨æœŸï¼š${cycleText}</div>
                    </div>
                    <div>
                        <button class="edit-btn" onclick="editSchedule(${schedule.id})">ç·¨è¼¯</button>
                        <button class="delete-btn" onclick="deleteSchedule(${schedule.id})">åˆªé™¤</button>
                    </div>
                `;
                divs.appendChild(div);
            });
        }

        function updateAnnouncementList() {
            const list = document.getElementById('announcementScheduleList');
            const divs = document.getElementById('announcementSchedules');
            if (announcements.length === 0) {
                list.classList.add('hidden');
                return;
            }
            list.classList.remove('hidden');
            divs.innerHTML = '';
            
            announcements.forEach(announcement => {
                let announcementCycleText = getCycleText(announcement, 'announcement');
                let exCycleText = getCycleText(announcement, 'ex');
                
                const div = document.createElement('div');
                div.className = 'schedule-item';
                div.innerHTML = `
                    <div class="schedule-info">
                        <strong>${announcement.stockName}</strong>
                        <div>ğŸ“¢ å…¬ä½ˆæ—¥ï¼š${announcement.announcementDate} | ${announcementCycleText}</div>
                        <div>ğŸ“… é™¤æ·¨æ—¥ï¼š${announcement.exDate} | ${exCycleText}</div>
                    </div>
                    <div>
                        <button class="edit-btn" onclick="editAnnouncement(${announcement.id})">ç·¨è¼¯</button>
                        <button class="delete-btn" onclick="deleteAnnouncement(${announcement.id})">åˆªé™¤</button>
                    </div>
                `;
                divs.appendChild(div);
            });
        }

        function getCycleText(announcement, type) {
            const prefix = type === 'announcement' ? 'announcement' : 'ex';
            const cycle = announcement[`${prefix}Cycle`];
            
            if (cycle === 'weekly') {
                const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                return `æ¯é€±${days[announcement[`${prefix}Weekday`]]}`;
            } else if (cycle === 'monthlyDate') {
                return `æ¯æœˆ${announcement[`${prefix}MonthlyDay`]}è™Ÿ`;
            } else if (cycle === 'everyXMonths') {
                return `æ¯éš” ${announcement[`${prefix}EveryXMonthsInterval`]} å€‹æœˆçš„ ${announcement[`${prefix}EveryXMonthsDay`]} è™Ÿ`;
            } else if (cycle === 'yearly') {
                return `æ¯å¹´ ${announcement[`${prefix}YearlyMonth`]} æœˆ ${announcement[`${prefix}YearlyDay`]} è™Ÿ`;
            }
            return '';
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            document.getElementById('calendarHeader').textContent = `${currentYear}å¹´${currentMonth}æœˆ`;
            calendar.innerHTML = '';
            const weekdays = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
            const dayClasses = ['sunday','','','','','','saturday'];
            weekdays.forEach((d,i)=> {
                const div=document.createElement('div');
                div.className=`weekday-header ${dayClasses[i]}`;
                div.textContent=d; calendar.appendChild(div);
            });
            const firstDay=new Date(currentYear,currentMonth-1,1).getDay();
            const daysInMonth=new Date(currentYear,currentMonth,0).getDate();
            for(let i=0;i<firstDay;i++){const div=document.createElement('div');div.className='calendar-day empty';calendar.appendChild(div);}
            const today=new Date();
            const isCurrent=today.getFullYear()===currentYear && today.getMonth()+1===currentMonth;
            for(let day=1;day<=daysInMonth;day++){
                const div=document.createElement('div');
                const dayOfWeek=new Date(currentYear,currentMonth-1,day).getDay();
                div.className='calendar-day';
                if(dayOfWeek===0)div.classList.add('sunday');
                if(dayOfWeek===6)div.classList.add('saturday');
                if(isCurrent && day===today.getDate())div.classList.add('today');
                const dn=document.createElement('div');
                dn.className='day-number'; dn.textContent=day;
                div.appendChild(dn);
                const events=getEventsForDate(currentYear,currentMonth,day);
                events.forEach(event=>{
                    const ed=document.createElement('div');
                    ed.className=`event ${event.type}`;
                    ed.textContent=`${event.stockName}${event.amount ? ' $'+event.amount : ''}`;
                    div.appendChild(ed);
                });
                calendar.appendChild(div);
            }
        }

        function getEventsForDate(year,month,day){
            const events=[]; const currentDate=new Date(year,month-1,day); currentDate.setHours(0,0,0,0);
            const dayOfWeek=currentDate.getDay();
            schedules.forEach(schedule=>{
                const startDate=new Date(schedule.buyDate); startDate.setHours(0,0,0,0);
                if(currentDate<startDate)return;
                if(!schedule.continuous){
                    if(currentDate.getTime()===startDate.getTime())
                        events.push({stockName:schedule.stockName,amount:schedule.amount,type:'once'});
                } else {
                    if(schedule.limitType==='limited'){
                        if(schedule.cycleType==='weekly'){
                            const weeksDiff=Math.floor((currentDate-startDate)/(7*24*60*60*1000));
                            if(weeksDiff>=schedule.periods)return;
                        } else {
                            const monthsDiff=(year-startDate.getFullYear())*12+(month-1-startDate.getMonth());
                            if(monthsDiff>=schedule.periods)return;
                        }
                    }
                    if(schedule.cycleType==='weekly' && dayOfWeek===schedule.weekday)
                        events.push({stockName:schedule.stockName,amount:schedule.amount,type:'weekly'});
                    else if(schedule.cycleType==='monthlyDate' && day===schedule.monthlyDay)
                        events.push({stockName:schedule.stockName,amount:schedule.amount,type:'monthly'});
                    else if(schedule.cycleType==='firstWorkday' && isFirstWorkday(year,month,day))
                        events.push({stockName:schedule.stockName,amount:schedule.amount,type:'monthly'});
                    else if(schedule.cycleType==='everyXMonths'){
                        const monthsDiff=(year-startDate.getFullYear())*12+(month-1-startDate.getMonth());
                        if(monthsDiff>=0 && monthsDiff % schedule.everyXMonthsInterval===0 && day===schedule.everyXMonthsDay)
                            events.push({stockName:schedule.stockName,amount:schedule.amount,type:'monthly'});
                    }
                }
            });
            
            // è™•ç†å…¬ä½ˆæ’ç¨‹
            announcements.forEach(announcement => {
                // è™•ç†å…¬ä½ˆæ—¥
                if (matchesCycle(announcement, 'announcement', year, month, day, dayOfWeek, currentDate)) {
                    events.push({
                        stockName: announcement.stockName + ' (å…¬ä½ˆ)',
                        amount: '',
                        type: 'announcement'
                    });
                }
                
                // è™•ç†é™¤æ·¨æ—¥
                if (matchesCycle(announcement, 'ex', year, month, day, dayOfWeek, currentDate)) {
                    events.push({
                        stockName: announcement.stockName + ' (é™¤æ·¨)',
                        amount: '',
                        type: 'exdate'
                    });
                }
            });
            
            return events;
        }

        function matchesCycle(announcement, type, year, month, day, dayOfWeek, currentDate) {
            const prefix = type === 'announcement' ? 'announcement' : 'ex';
            const startDate = new Date(announcement[`${type === 'announcement' ? 'announcementDate' : 'exDate'}`]);
            startDate.setHours(0, 0, 0, 0);
            
            if (currentDate < startDate) return false;
            
            const cycle = announcement[`${prefix}Cycle`];
            
            if (cycle === 'weekly') {
                return dayOfWeek === announcement[`${prefix}Weekday`];
            } else if (cycle === 'monthlyDate') {
                return day === announcement[`${prefix}MonthlyDay`];
            } else if (cycle === 'everyXMonths') {
                const monthsDiff = (year - startDate.getFullYear()) * 12 + (month - 1 - startDate.getMonth());
                return monthsDiff >= 0 && 
                       monthsDiff % announcement[`${prefix}EveryXMonthsInterval`] === 0 && 
                       day === announcement[`${prefix}EveryXMonthsDay`];
            } else if (cycle === 'yearly') {
                return month === announcement[`${prefix}YearlyMonth`] && 
                       day === announcement[`${prefix}YearlyDay`];
            }
            
            return false;
        }

        function isFirstWorkday(year,month,day){
            const date=new Date(year,month-1,day); const dow=date.getDay();
            if(dow===0||dow===6)return false;
            for(let d=1;d<day;d++){
                const check=new Date(year,month-1,d);
                const cd=check.getDay();
                if(cd!==0 && cd!==6)return false;
            }
            return true;
        }

        // ======================================
        // å¹´æœˆé¸æ“‡å™¨
        // ======================================
        const yearSelect=document.getElementById('yearSelect');
        for(let y=currentYear-2;y<=currentYear+5;y++){
            const opt=document.createElement('option');
            opt.value=y; opt.textContent=y;
            if(y===currentYear)opt.selected=true;
            yearSelect.appendChild(opt);
        }
        yearSelect.addEventListener('change',e=>{currentYear=parseInt(e.target.value);renderCalendar();});
        const monthSelect=document.getElementById('monthSelect');
        monthSelect.value=currentMonth;
        monthSelect.addEventListener('change',e=>{currentMonth=parseInt(e.target.value);renderCalendar();});

        // ======================================
        // è³‡æ–™åŒ¯å‡º/åŒ¯å…¥/é‡è¨­
        // ======================================
        function exportData(){
            if(schedules.length===0 && announcements.length===0){alert('âš ï¸ æ²’æœ‰æ•¸æ“šå¯ä»¥å°å‡ºï¼');return;}
            const dataStr=JSON.stringify({
                schedules,
                announcements
            },null,2);
            const blob=new Blob([dataStr],{type:"application/json"});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');
            a.href=url;
            a.download=`è²·å…¥æ™‚é–“è¡¨_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a); a.click();
            document.body.removeChild(a); URL.revokeObjectURL(url);
            alert('âœ… æ•¸æ“šå·²å°å‡ºï¼');
        }

        function importData(){document.getElementById('importFile').click();}

        async function resetData(){
            if(schedules.length===0 && announcements.length===0){alert('âš ï¸ ç›®å‰æ²’æœ‰ä»»ä½•æ•¸æ“šï¼');return;}
            if(confirm('âš ï¸ ç¢ºå®šè¦é‡è¨­æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ')){
                if(confirm('âš ï¸ å†æ¬¡ç¢ºèªï¼šçœŸçš„è¦åˆªé™¤æ‰€æœ‰æ’ç¨‹å—ï¼Ÿ')){
                    schedules=[]; 
                    announcements=[];
                    await saveSchedules();
                    await saveAnnouncements();
                    updateScheduleList();
                    updateAnnouncementList();
                    renderCalendar();
                    alert('âœ… æ•¸æ“šå·²é‡è¨­ï¼');
                }
            }
        }

        document.getElementById('exportBtnInput').addEventListener('click',e=>{e.preventDefault();exportData();});
        document.getElementById('importBtnInput').addEventListener('click',e=>{e.preventDefault();importData();});
        document.getElementById('resetBtnInput').addEventListener('click',e=>{e.preventDefault();resetData();});
        document.getElementById('exportBtn').addEventListener('click',e=>{e.preventDefault();exportData();});
        document.getElementById('importBtn').addEventListener('click',e=>{e.preventDefault();importData();});
        document.getElementById('resetBtn').addEventListener('click',e=>{e.preventDefault();resetData();});
        document.getElementById('exportBtnAnnouncement').addEventListener('click',e=>{e.preventDefault();exportData();});
        document.getElementById('importBtnAnnouncement').addEventListener('click',e=>{e.preventDefault();importData();});
        document.getElementById('resetBtnAnnouncement').addEventListener('click',e=>{e.preventDefault();resetData();});

        document.getElementById('importFile').addEventListener('change',async e=>{
            const file=e.target.files[0]; if(!file)return;
            const reader=new FileReader();
            reader.onload=async ev=>{
                try{
                    const imported=JSON.parse(ev.target.result);
                    let schedulesData = [];
                    let announcementsData = [];
                    
                    if (Array.isArray(imported)) {
                        // èˆŠæ ¼å¼å…¼å®¹ - ç´”é™£åˆ—æ ¼å¼
                        schedulesData = imported;
                    } else {
                        // æ–°æ ¼å¼ - åŒ…å« schedules å’Œ announcements
                        schedulesData = imported.schedules || [];
                        announcementsData = imported.announcements || [];
                    }
                    
                    if(schedulesData.length===0 && announcementsData.length===0){alert('âš ï¸ æª”æ¡ˆä¸­æ²’æœ‰ä»»ä½•æ•¸æ“šï¼');return;}
                    if(confirm(`ç¢ºå®šè¦åŒ¯å…¥ ${schedulesData.length} å€‹è²·å…¥æ’ç¨‹å’Œ ${announcementsData.length} å€‹å…¬ä½ˆæ’ç¨‹å—ï¼Ÿç¾æœ‰æ•¸æ“šå°‡è¢«è¦†è“‹ã€‚`)){
                        schedules=schedulesData;
                        announcements=announcementsData;
                        await saveSchedules();
                        await saveAnnouncements();
                        updateScheduleList();
                        updateAnnouncementList();
                        renderCalendar();
                        alert('âœ… æ•¸æ“šå·²åŒ¯å…¥ï¼');
                    }
                }catch(err){alert('âŒ åŒ¯å…¥å¤±æ•—ï¼');console.error(err);}
            };
            reader.readAsText(file);
            e.target.value='';
        });
// ======================================
// GitHub åŒæ­¥åŠŸèƒ½
// ======================================
const DATA_FILENAME = 'buyinschedule-data.json';

async function syncToGitHub() {
    if (typeof GitHubSync === 'undefined') {
        alert('âŒ GitHub åŒæ­¥æ¨¡çµ„æœªè¼‰å…¥ï¼Œè«‹ç¢ºèª github-sync.js æª”æ¡ˆå­˜åœ¨');
        return;
    }
    
    if (!GitHubSync.isConfigured()) {
        alert('âŒ è«‹å…ˆåœ¨ guide.html è¨­å®š GitHub Token');
        return;
    }
    
    const dataToSave = {
        schedules: schedules,
        announcements: announcements
    };
    
    alert('â³ åŒæ­¥ä¸­...');
    const success = await GitHubSync.saveToGitHub(DATA_FILENAME, dataToSave);
    if (success) {
        alert('âœ… å·²åŒæ­¥åˆ° GitHubï¼');
    } else {
        alert('âŒ åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®š');
    }
}

async function loadFromGitHub() {
    if (typeof GitHubSync === 'undefined') {
        alert('âŒ GitHub åŒæ­¥æ¨¡çµ„æœªè¼‰å…¥');
        return;
    }
    
    if (!GitHubSync.isConfigured()) {
        alert('âŒ è«‹å…ˆåœ¨ guide.html è¨­å®š GitHub Token');
        return;
    }
    
    alert('â³ è¼‰å…¥ä¸­...');
    const data = await GitHubSync.loadFromGitHub(DATA_FILENAME);
    if (data) {
        schedules = data.schedules || [];
        announcements = data.announcements || [];
        await saveSchedules();
        await saveAnnouncements();
        updateScheduleList();
        updateAnnouncementList();
        renderCalendar();
        alert(`âœ… å·²å¾ GitHub è¼‰å…¥ ${schedules.length} å€‹è²·å…¥æ’ç¨‹å’Œ ${announcements.length} å€‹å…¬ä½ˆæ’ç¨‹ï¼`);
    } else {
        alert('âŒ GitHub ä¸Šæ²’æœ‰æ‰¾åˆ°è³‡æ–™ï¼Œæˆ–è¼‰å…¥å¤±æ•—');
    }
}

// GitHub åŒæ­¥æŒ‰éˆ•äº‹ä»¶ç¶å®š
document.getElementById('syncToGitHubBtn').addEventListener('click', syncToGitHub);
document.getElementById('loadFromGitHubBtn').addEventListener('click', loadFromGitHub);
document.getElementById('syncToGitHubBtnInput').addEventListener('click', syncToGitHub);
document.getElementById('loadFromGitHubBtnInput').addEventListener('click', loadFromGitHub);
document.getElementById('syncToGitHubBtnAnnouncement').addEventListener('click', syncToGitHub);
document.getElementById('loadFromGitHubBtnAnnouncement').addEventListener('click', loadFromGitHub);
        // ======================================
        // åˆå§‹åŒ–
        // ======================================
        loadSchedules();
        loadAnnouncements();
    </script>
    <script src="github-sync.js"></script>
</body>
</html>